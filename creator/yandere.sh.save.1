#!/bin/bash


TAG="$1"
[ -z "$TAG" ] && exit 1

POST=$(wget -q -O- "https://yande.re/post?tags=${TAG}+order%3Arandom+rating%3Asafe+score%3A20.." | grep -E -o 'href="/post/show/[0-9]+' | head -n1 | cut -d '/' -f4)
URL=$(wget -q -O- "https://yande.re/post/show/${POST}" | grep 'Post.register_resp(' | grep '"id":'$POST | grep -o -E '"file_url":"http[^"]+"' | cut -d'"' -f4)
//derpicdn.net/img/2012/10/10/118724/small.png
//derpicdn.net/img/2012/10/16/124174/small.jpg
//derpicdn.net/img/2012/10/20/128419/small.png
//derpicdn.net/img/2012/10/28/134610/small.jpg
//derpicdn.net/img/2012/10/28/134741/small.jpg
//derpicdn.net/img/2012/11/1/138819/small.png
//derpicdn.net/img/2012/11/15/153232/small.png
//derpicdn.net/img/2012/11/17/154674/small.jpg
//derpicdn.net/img/2012/11/22/159841/small.png
//derpicdn.net/img/2012/11/25/162718/small.png
//derpicdn.net/img/2012/11/26/163771/small.png
//derpicdn.net/img/2012/1/15/322/small.jpg
//derpicdn.net/img/2012/11/6/144313/small.png
//derpicdn.net/img/2012/11/6/144507/small.png
//derpicdn.net/img/2012/1/16/409/small.jpg
//derpicdn.net/img/2012/1/16/422/small.gif
//derpicdn.net/img/2012/1/16/445/small.png
//derpicdn.net/img/2012/1/16/449/small.png
//derpicdn.net/img/2012/1/17/599/small.png
//derpicdn.net/img/2012/1/17/601/small.png
//derpicdn.net/img/2012/1/20/982/small.jpeg
//derpicdn.net/img/2012/1/2/0/small.jpg
//derpicdn.net/img/2012/12/12/180017/small.jpg
//derpicdn.net/img/2012/1/22/1193/small.png
//derpicdn.net/img/2012/1/22/1200/small.png
//derpicdn.net/img/2012/1/22/1212/small.jpg
//derpicdn.net/img/2012/1/2/23/small.png
//derpicdn.net/img/2012/12/24/192426/small.jpeg
//derpicdn.net/img/2012/12/31/198511/small.png
//derpicdn.net/img/2012/1/23/1597/small.jpg
//derpicdn.net/img/2012/1/2/3/small.png
//derpicdn.net/img/2012/2/1/2711/small.jpg
//derpicdn.net/img/2012/2/2/2772/small.png
//derpicdn.net/img/2012/2/2/2773/small.png
//derpicdn.net/img/2012/2/2/2871/small.png
//derpicdn.net/img/2012/2/2/2910/small.png
//derpicdn.net/img/2012/2/28/3627/small.png
//derpicdn.net/img/2012/2/6/2942/small.jpg
//derpicdn.net/img/2012/2/6/2948/small.png
//derpicdn.net/img/2012/3/22/3827/small.jpg
//derpicdn.net/img/2012/3/22/3828/small.png
//derpicdn.net/img/2012/6/17/4611/small.jpg
//derpicdn.net/img/2012/6/17/4669/small.jpg
//derpicdn.net/img/2012/6/17/4717/small.png
//derpicdn.net/img/2012/6/17/5085/small.jpg
//derpicdn.net/img/2012/6/17/5093/small.jpg
//derpicdn.net/img/2012/6/18/5793/small.png
//derpicdn.net/img/2012/6/18/5959/small.jpg
//derpicdn.net/img/2012/6/18/6663/small.jpg
//derpicdn.net/img/2012/6/18/8152/small.jpg
//derpicdn.net/img/2012/6/18/8419/small.png
//derpicdn.net/img/2012/6/20/11623/small.jpg
//derpicdn.net/img/2012/6/20/11709/small.jpeg
//derpicdn.net/img/2012/6/20/12215/small.png
//derpicdn.net/img/2012/6/20/12446/small.jpg
//derpicdn.net/img/2012/6/21/14351/small.jpg
//derpicdn.net/img/2012/6/21/14445/small.jpg
//derpicdn.net/img/2012/6/22/15137/small.jpg

wget "$URL"
exit $?
